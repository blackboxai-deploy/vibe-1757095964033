<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NH BOX - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a0000 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Left Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #8B0000 0%, #000000 100%);
            border-right: 2px solid #FF0000;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #FF0000;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(255, 0, 0, 0.5);
        }

        .connection-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .connection-status.connected {
            background: #008000;
            color: white;
        }

        .connection-status.disconnected {
            background: #FF0000;
            color: white;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            border-bottom: 1px solid rgba(255, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255, 0, 0, 0.2);
            border-left: 4px solid #FF0000;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 20px;
            width: calc(100% - 280px);
            min-height: 100vh;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            background: linear-gradient(90deg, #8B0000, #FF0000);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
        }

        .section-title {
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Form Styles */
        .form-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #8B0000;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.3);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
        }

        .form-group.full-width {
            flex: 100%;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #CCCCCC;
            font-weight: bold;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #8B0000;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #FF0000;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(45deg, #8B0000, #FF0000);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #333, #666);
        }

        .btn-danger {
            background: linear-gradient(45deg, #FF0000, #FF4444);
        }

        /* Cast Management */
        .cast-container {
            background: rgba(139, 0, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #8B0000;
            margin: 20px 0;
        }

        .cast-member {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        .cast-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #8B0000;
        }

        .cast-info {
            flex: 1;
        }

        .cast-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cast-character {
            color: #CCCCCC;
            font-size: 12px;
        }

        /* Episodes Management */
        .episodes-container {
            margin-top: 20px;
        }

        .episode-item {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #8B0000;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .episode-number {
            background: #8B0000;
            color: white;
            padding: 8px 12px;
            border-radius: 50%;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .content-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(139, 0, 0, 0.2));
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #8B0000;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 0, 0, 0.4);
            border-color: #FF0000;
        }

        .card-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .card-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .card-badge {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .card-content {
            padding: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-year {
            color: #CCCCCC;
            font-size: 14px;
        }

        .card-rating {
            background: #8B0000;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 12px;
            flex: 1;
        }

        /* Loading and Messages */
        .loading {
            text-align: center;
            padding: 40px;
            color: #CCCCCC;
        }

        .loading:after {
            content: '‚è≥';
            font-size: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .message.success {
            background: rgba(0, 128, 0, 0.2);
            border: 1px solid #008000;
            color: #00FF00;
        }

        .message.error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #FF0000;
            color: #FF4444;
        }

        .message.info {
            background: rgba(0, 0, 255, 0.2);
            border: 1px solid #0000FF;
            color: #4444FF;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .form-row {
                flex-direction: column;
            }

            .form-group {
                min-width: 100%;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .cast-member {
                flex-direction: column;
                text-align: center;
            }

            .card-actions {
                flex-direction: column;
            }
        }

        /* Search and Filter */
        .search-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #8B0000;
            margin-bottom: 20px;
        }

        .search-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .search-group {
            flex: 1;
            min-width: 200px;
        }

        /* TMDB Integration */
        .tmdb-section {
            background: rgba(139, 0, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #8B0000;
            margin: 20px 0;
        }

        .tmdb-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tmdb-logo {
            font-size: 18px;
            font-weight: bold;
            color: #FF0000;
        }

        .tmdb-input-row {
            display: flex;
            gap: 15px;
            align-items: end;
        }

        .tmdb-id-group {
            flex: 1;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.online {
            background: #00FF00;
            box-shadow: 0 0 10px #00FF00;
        }

        .status-indicator.offline {
            background: #FF0000;
            box-shadow: 0 0 10px #FF0000;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">NH BOX ADMIN</div>
                <div class="connection-status" id="connectionStatus">
                    <span class="status-indicator" id="statusIndicator"></span>
                    Connecting...
                </div>
            </div>
            <nav class="nav-menu">
                <a class="nav-item active" onclick="showSection('dashboard')">
                    üìä Dashboard
                </a>
                <a class="nav-item" onclick="showSection('add-webseries')">
                    üì∫ Add Web Series
                </a>
                <a class="nav-item" onclick="showSection('edit-webseries')">
                    ‚úèÔ∏è Edit Web Series
                </a>
                <a class="nav-item" onclick="showSection('add-movie')">
                    üé¨ Add Movie
                </a>
                <a class="nav-item" onclick="showSection('edit-movie')">
                    üé≠ Edit Movie
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h1 class="section-title">üìä Dashboard</h1>
                </div>
                
                <div class="content-grid">
                    <div class="content-card" onclick="showSection('add-webseries')">
                        <div class="card-image" style="background: linear-gradient(45deg, #8B0000, #FF0000); display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 48px;">üì∫</span>
                        </div>
                        <div class="card-content">
                            <div class="card-title">Add Web Series</div>
                            <p style="color: #CCCCCC;">Add new web series with TMDB integration</p>
                        </div>
                    </div>
                    
                    <div class="content-card" onclick="showSection('edit-webseries')">
                        <div class="card-image" style="background: linear-gradient(45deg, #8B0000, #000000); display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 48px;">‚úèÔ∏è</span>
                        </div>
                        <div class="card-content">
                            <div class="card-title">Edit Web Series</div>
                            <p style="color: #CCCCCC;">Manage existing web series content</p>
                        </div>
                    </div>
                    
                    <div class="content-card" onclick="showSection('add-movie')">
                        <div class="card-image" style="background: linear-gradient(45deg, #FF0000, #8B0000); display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 48px;">üé¨</span>
                        </div>
                        <div class="card-content">
                            <div class="card-title">Add Movie</div>
                            <p style="color: #CCCCCC;">Add new movies with TMDB integration</p>
                        </div>
                    </div>
                    
                    <div class="content-card" onclick="showSection('edit-movie')">
                        <div class="card-image" style="background: linear-gradient(45deg, #000000, #8B0000); display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 48px;">üé≠</span>
                        </div>
                        <div class="card-content">
                            <div class="card-title">Edit Movie</div>
                            <p style="color: #CCCCCC;">Manage existing movie content</p>
                        </div>
                    </div>
                </div>

                <div class="form-container" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">üìä Quick Stats</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Total Web Series</label>
                            <div id="totalWebSeries" style="font-size: 24px; font-weight: bold; color: #FF0000;">0</div>
                        </div>
                        <div class="form-group">
                            <label>Total Movies</label>
                            <div id="totalMovies" style="font-size: 24px; font-weight: bold; color: #FF0000;">0</div>
                        </div>
                        <div class="form-group">
                            <label>Database Status</label>
                            <div id="dbStatus" style="font-size: 18px; font-weight: bold;">
                                <span class="connection-status" id="dashboardStatus">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Web Series Section -->
            <div id="add-webseries" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">üì∫ Add Web Series</h1>
                </div>

                <!-- TMDB Integration -->
                <div class="tmdb-section">
                    <div class="tmdb-header">
                        <span class="tmdb-logo">üé¨ TMDB Integration</span>
                    </div>
                    <div class="tmdb-input-row">
                        <div class="tmdb-id-group">
                            <label for="seriesTmdbId">TMDB Series ID</label>
                            <input type="number" id="seriesTmdbId" placeholder="Enter TMDB Series ID (e.g., 1399 for Game of Thrones)">
                        </div>
                        <button class="btn" onclick="fetchSeriesData()">Fetch Data</button>
                    </div>
                </div>

                <form id="webSeriesForm" class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="seriesTitle">Title *</label>
                            <input type="text" id="seriesTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="seriesYear">Year *</label>
                            <input type="number" id="seriesYear" min="1900" max="2030" required>
                        </div>
                        <div class="form-group">
                            <label for="seriesRating">Rating (0-10) *</label>
                            <input type="number" id="seriesRating" min="0" max="10" step="0.1" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="seriesPoster">Poster URL *</label>
                            <input type="url" id="seriesPoster" required>
                        </div>
                        <div class="form-group">
                            <label for="seriesBackdrop">Backdrop URL *</label>
                            <input type="url" id="seriesBackdrop" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="seriesLanguage">Language *</label>
                            <select id="seriesLanguage" required>
                                <option value="">Select Language</option>
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Tamil">Tamil</option>
                                <option value="Telugu">Telugu</option>
                                <option value="Kannada">Kannada</option>
                                <option value="Malayalam">Malayalam</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seriesCategory">Category *</label>
                            <select id="seriesCategory" required>
                                <option value="">Select Category</option>
                                <option value="Hollywood">Hollywood</option>
                                <option value="Bollywood">Bollywood</option>
                                <option value="South Indian">South Indian</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seriesAccess">Access Level *</label>
                            <select id="seriesAccess" required>
                                <option value="">Select Access</option>
                                <option value="FREE">FREE</option>
                                <option value="VIP">VIP</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="seriesStoryline">Storyline *</label>
                        <textarea id="seriesStoryline" rows="4" required></textarea>
                    </div>

                    <!-- Cast Section -->
                    <div class="cast-container">
                        <h3 style="margin-bottom: 15px;">üë• Top Billed Cast</h3>
                        <div id="seriesCastContainer"></div>
                        <button type="button" class="btn btn-secondary" onclick="addCastMember('series')">Add Cast Member</button>
                    </div>

                    <!-- Episodes Section -->
                    <div class="episodes-container">
                        <h3 style="margin-bottom: 15px;">üì∫ Episodes</h3>
                        <div id="seriesEpisodesContainer"></div>
                        <button type="button" class="btn btn-secondary" onclick="addEpisode()">Add Episode</button>
                    </div>

                    <div class="form-row" style="margin-top: 30px; justify-content: center;">
                        <button type="submit" class="btn">üíæ Save Web Series</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm('series')">üóëÔ∏è Clear Form</button>
                    </div>
                </form>
            </div>

            <!-- Edit Web Series Section -->
            <div id="edit-webseries" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">‚úèÔ∏è Edit Web Series</h1>
                </div>

                <div class="search-container">
                    <div class="search-row">
                        <div class="search-group">
                            <label for="seriesSearchInput">Search Web Series</label>
                            <input type="text" id="seriesSearchInput" placeholder="Search by title...">
                        </div>
                        <div class="search-group">
                            <label for="seriesCategoryFilter">Filter by Category</label>
                            <select id="seriesCategoryFilter">
                                <option value="">All Categories</option>
                                <option value="Hollywood">Hollywood</option>
                                <option value="Bollywood">Bollywood</option>
                                <option value="South Indian">South Indian</option>
                            </select>
                        </div>
                        <div class="search-group">
                            <label for="seriesAccessFilter">Filter by Access</label>
                            <select id="seriesAccessFilter">
                                <option value="">All Access</option>
                                <option value="FREE">FREE</option>
                                <option value="VIP">VIP</option>
                            </select>
                        </div>
                        <button class="btn" onclick="loadWebSeries()">üîç Search</button>
                    </div>
                </div>

                <div id="webSeriesGrid" class="content-grid">
                    <div class="loading">Loading web series...</div>
                </div>
            </div>

            <!-- Add Movie Section -->
            <div id="add-movie" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">üé¨ Add Movie</h1>
                </div>

                <!-- TMDB Integration -->
                <div class="tmdb-section">
                    <div class="tmdb-header">
                        <span class="tmdb-logo">üé¨ TMDB Integration</span>
                    </div>
                    <div class="tmdb-input-row">
                        <div class="tmdb-id-group">
                            <label for="movieTmdbId">TMDB Movie ID</label>
                            <input type="number" id="movieTmdbId" placeholder="Enter TMDB Movie ID (e.g., 550 for Fight Club)">
                        </div>
                        <button class="btn" onclick="fetchMovieData()">Fetch Data</button>
                    </div>
                </div>

                <form id="movieForm" class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="movieTitle">Title *</label>
                            <input type="text" id="movieTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="movieYear">Year *</label>
                            <input type="number" id="movieYear" min="1900" max="2030" required>
                        </div>
                        <div class="form-group">
                            <label for="movieRating">Rating (0-10) *</label>
                            <input type="number" id="movieRating" min="0" max="10" step="0.1" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="moviePoster">Poster URL *</label>
                            <input type="url" id="moviePoster" required>
                        </div>
                        <div class="form-group">
                            <label for="movieBackdrop">Backdrop URL *</label>
                            <input type="url" id="movieBackdrop" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="movieLanguage">Language *</label>
                            <select id="movieLanguage" required>
                                <option value="">Select Language</option>
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Tamil">Tamil</option>
                                <option value="Telugu">Telugu</option>
                                <option value="Kannada">Kannada</option>
                                <option value="Malayalam">Malayalam</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="movieCategory">Category *</label>
                            <select id="movieCategory" required>
                                <option value="">Select Category</option>
                                <option value="Hollywood">Hollywood</option>
                                <option value="Bollywood">Bollywood</option>
                                <option value="South Indian">South Indian</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="movieAccess">Access Level *</label>
                            <select id="movieAccess" required>
                                <option value="">Select Access</option>
                                <option value="FREE">FREE</option>
                                <option value="VIP">VIP</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="movieStoryline">Storyline *</label>
                        <textarea id="movieStoryline" rows="4" required></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="movieLink">Movie Stream Link *</label>
                        <input type="url" id="movieLink" required placeholder="https://example.com/movie.mp4">
                    </div>

                    <!-- Cast Section -->
                    <div class="cast-container">
                        <h3 style="margin-bottom: 15px;">üë• Top Billed Cast</h3>
                        <div id="movieCastContainer"></div>
                        <button type="button" class="btn btn-secondary" onclick="addCastMember('movie')">Add Cast Member</button>
                    </div>

                    <div class="form-row" style="margin-top: 30px; justify-content: center;">
                        <button type="submit" class="btn">üíæ Save Movie</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm('movie')">üóëÔ∏è Clear Form</button>
                    </div>
                </form>
            </div>

            <!-- Edit Movie Section -->
            <div id="edit-movie" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">üé≠ Edit Movie</h1>
                </div>

                <div class="search-container">
                    <div class="search-row">
                        <div class="search-group">
                            <label for="movieSearchInput">Search Movies</label>
                            <input type="text" id="movieSearchInput" placeholder="Search by title...">
                        </div>
                        <div class="search-group">
                            <label for="movieCategoryFilter">Filter by Category</label>
                            <select id="movieCategoryFilter">
                                <option value="">All Categories</option>
                                <option value="Hollywood">Hollywood</option>
                                <option value="Bollywood">Bollywood</option>
                                <option value="South Indian">South Indian</option>
                            </select>
                        </div>
                        <div class="search-group">
                            <label for="movieAccessFilter">Filter by Access</label>
                            <select id="movieAccessFilter">
                                <option value="">All Access</option>
                                <option value="FREE">FREE</option>
                                <option value="VIP">VIP</option>
                            </select>
                        </div>
                        <button class="btn" onclick="loadMovies()">üîç Search</button>
                    </div>
                </div>

                <div id="moviesGrid" class="content-grid">
                    <div class="loading">Loading movies...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="firebase-config.js"></script>
    <script src="tmdb-api.js"></script>
    <script>
        // Global variables
        let currentSection = 'dashboard';
        let castCounter = 0;
        let episodeCounter = 0;
        let webSeriesData = {};
        let moviesData = {};

        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdmin();
        });

        function initializeAdmin() {
            // Update connection status
            updateConnectionStatus();
            
            // Load dashboard data
            loadDashboardStats();
            
            // Set up form event listeners
            setupFormEventListeners();
            
            // Start real-time listeners
            startRealtimeListeners();
        }

        function setupFormEventListeners() {
            // Web Series form
            const webSeriesForm = document.getElementById('webSeriesForm');
            if (webSeriesForm) {
                webSeriesForm.addEventListener('submit', handleWebSeriesSubmit);
            }

            // Movie form
            const movieForm = document.getElementById('movieForm');
            if (movieForm) {
                movieForm.addEventListener('submit', handleMovieSubmit);
            }

            // Search inputs
            const seriesSearchInput = document.getElementById('seriesSearchInput');
            if (seriesSearchInput) {
                seriesSearchInput.addEventListener('input', debounce(searchWebSeries, 500));
            }

            const movieSearchInput = document.getElementById('movieSearchInput');
            if (movieSearchInput) {
                movieSearchInput.addEventListener('input', debounce(searchMovies, 500));
            }
        }

        function startRealtimeListeners() {
            // Listen to web series changes
            window.FirebaseDB.listenToWebSeries((data) => {
                webSeriesData = data;
                if (currentSection === 'edit-webseries') {
                    renderWebSeriesGrid();
                }
                updateDashboardStats();
            });

            // Listen to movies changes
            window.FirebaseDB.listenToMovies((data) => {
                moviesData = data;
                if (currentSection === 'edit-movie') {
                    renderMoviesGrid();
                }
                updateDashboardStats();
            });
        }

        // Section navigation
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));

            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionId;
            }

            // Update navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            const clickedNav = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
            if (clickedNav) {
                clickedNav.classList.add('active');
            }

            // Load section-specific data
            switch(sectionId) {
                case 'edit-webseries':
                    loadWebSeries();
                    break;
                case 'edit-movie':
                    loadMovies();
                    break;
                case 'dashboard':
                    loadDashboardStats();
                    break;
            }
        }

        // Dashboard functions
        function loadDashboardStats() {
            updateDashboardStats();
        }

        function updateDashboardStats() {
            const totalWebSeries = Object.keys(webSeriesData).length;
            const totalMovies = Object.keys(moviesData).length;
            
            document.getElementById('totalWebSeries').textContent = totalWebSeries;
            document.getElementById('totalMovies').textContent = totalMovies;
        }

        // TMDB Integration
        async function fetchSeriesData() {
            const tmdbId = document.getElementById('seriesTmdbId').value;
            if (!tmdbId) {
                window.showNotification('Please enter a TMDB Series ID', 'error');
                return;
            }

            try {
                window.showNotification('Fetching series data from TMDB...', 'info');
                const seriesData = await window.TMDBAPI.fetchTVSeriesDetails(tmdbId);
                
                // Populate form
                populateSeriesForm(seriesData);
                window.showNotification('Series data fetched successfully!', 'success');
            } catch (error) {
                console.error('Error fetching series data:', error);
                window.showNotification('Error fetching series data: ' + error.message, 'error');
            }
        }

        async function fetchMovieData() {
            const tmdbId = document.getElementById('movieTmdbId').value;
            if (!tmdbId) {
                window.showNotification('Please enter a TMDB Movie ID', 'error');
                return;
            }

            try {
                window.showNotification('Fetching movie data from TMDB...', 'info');
                const movieData = await window.TMDBAPI.fetchMovieDetails(tmdbId);
                
                // Populate form
                populateMovieForm(movieData);
                window.showNotification('Movie data fetched successfully!', 'success');
            } catch (error) {
                console.error('Error fetching movie data:', error);
                window.showNotification('Error fetching movie data: ' + error.message, 'error');
            }
        }

        function populateSeriesForm(data) {
            document.getElementById('seriesTitle').value = data.title || '';
            document.getElementById('seriesYear').value = data.year || '';
            document.getElementById('seriesRating').value = data.rating || '';
            document.getElementById('seriesPoster').value = data.poster || '';
            document.getElementById('seriesBackdrop').value = data.backdrop || '';
            document.getElementById('seriesStoryline').value = data.storyline || '';

            // Auto-determine category based on language
            const category = window.TMDBAPI.determineCategory([], data.language);
            document.getElementById('seriesCategory').value = category;

            // Clear and populate cast
            document.getElementById('seriesCastContainer').innerHTML = '';
            if (data.cast && data.cast.length > 0) {
                data.cast.forEach(castMember => {
                    addCastMemberWithData('series', castMember.name, castMember.photo, castMember.character);
                });
            }
        }

        function populateMovieForm(data) {
            document.getElementById('movieTitle').value = data.title || '';
            document.getElementById('movieYear').value = data.year || '';
            document.getElementById('movieRating').value = data.rating || '';
            document.getElementById('moviePoster').value = data.poster || '';
            document.getElementById('movieBackdrop').value = data.backdrop || '';
            document.getElementById('movieStoryline').value = data.storyline || '';

            // Auto-determine category based on language
            const category = window.TMDBAPI.determineCategory([], data.language);
            document.getElementById('movieCategory').value = category;

            // Clear and populate cast
            document.getElementById('movieCastContainer').innerHTML = '';
            if (data.cast && data.cast.length > 0) {
                data.cast.forEach(castMember => {
                    addCastMemberWithData('movie', castMember.name, castMember.photo, castMember.character);
                });
            }
        }

        // Cast Management
        function addCastMember(type) {
            addCastMemberWithData(type, '', '', '');
        }

        function addCastMemberWithData(type, name, photo, character) {
            const containerId = type === 'series' ? 'seriesCastContainer' : 'movieCastContainer';
            const container = document.getElementById(containerId);
            const castId = `cast_${type}_${castCounter++}`;

            const castHtml = `
                <div class="cast-member" id="${castId}">
                    <img class="cast-photo" src="${photo || 'https://placehold.co/60x60?text=No+Photo'}" alt="Cast Photo" onerror="this.src='https://placehold.co/60x60?text=No+Photo'">
                    <div class="cast-info">
                        <input type="text" placeholder="Actor Name" value="${name}" class="cast-name-input" style="background: transparent; border: 1px solid #8B0000; padding: 8px; margin-bottom: 5px; width: 100%; color: white;">
                        <input type="text" placeholder="Character Name" value="${character}" class="cast-character-input" style="background: transparent; border: 1px solid #8B0000; padding: 8px; margin-bottom: 5px; width: 100%; color: white;">
                        <input type="url" placeholder="Photo URL" value="${photo}" class="cast-photo-input" style="background: transparent; border: 1px solid #8B0000; padding: 8px; width: 100%; color: white;" onchange="updateCastPhoto('${castId}', this.value)">
                    </div>
                    <button type="button" class="btn btn-danger btn-small" onclick="removeCastMember('${castId}')">Remove</button>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', castHtml);
        }

        function updateCastPhoto(castId, photoUrl) {
            const castMember = document.getElementById(castId);
            if (castMember) {
                const img = castMember.querySelector('.cast-photo');
                img.src = photoUrl || 'https://placehold.co/60x60?text=No+Photo';
            }
        }

        function removeCastMember(castId) {
            const castMember = document.getElementById(castId);
            if (castMember) {
                castMember.remove();
            }
        }

        // Episode Management (for web series)
        function addEpisode() {
            const container = document.getElementById('seriesEpisodesContainer');
            const episodeId = `episode_${episodeCounter++}`;

            const episodeHtml = `
                <div class="episode-item" id="${episodeId}">
                    <div class="episode-number">${episodeCounter}</div>
                    <div style="flex: 1;">
                        <div style="display: flex; gap: 15px; margin-bottom: 10px;">
                            <input type="number" placeholder="Season" min="1" class="episode-season" style="width: 100px; background: transparent; border: 1px solid #8B0000; padding: 8px; color: white;">
                            <input type="number" placeholder="Episode" min="1" class="episode-number-input" style="width: 100px; background: transparent; border: 1px solid #8B0000; padding: 8px; color: white;">
                            <input type="text" placeholder="Episode Name" class="episode-name" style="flex: 1; background: transparent; border: 1px solid #8B0000; padding: 8px; color: white;">
                        </div>
                        <input type="url" placeholder="Episode Stream Link" class="episode-link" style="width: 100%; background: transparent; border: 1px solid #8B0000; padding: 8px; color: white;">
                    </div>
                    <button type="button" class="btn btn-danger btn-small" onclick="removeEpisode('${episodeId}')">Remove</button>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', episodeHtml);
        }

        function removeEpisode(episodeId) {
            const episode = document.getElementById(episodeId);
            if (episode) {
                episode.remove();
            }
        }

        // Form submission handlers
        async function handleWebSeriesSubmit(event) {
            event.preventDefault();

            try {
                const formData = collectWebSeriesFormData();
                if (!formData) return;

                window.showNotification('Saving web series...', 'info');
                await window.FirebaseDB.saveWebSeries(formData);
                window.showNotification('Web series saved successfully!', 'success');
                
                clearForm('series');
            } catch (error) {
                console.error('Error saving web series:', error);
                window.showNotification('Error saving web series: ' + error.message, 'error');
            }
        }

        async function handleMovieSubmit(event) {
            event.preventDefault();

            try {
                const formData = collectMovieFormData();
                if (!formData) return;

                window.showNotification('Saving movie...', 'info');
                await window.FirebaseDB.saveMovie(formData);
                window.showNotification('Movie saved successfully!', 'success');
                
                clearForm('movie');
            } catch (error) {
                console.error('Error saving movie:', error);
                window.showNotification('Error saving movie: ' + error.message, 'error');
            }
        }

        function collectWebSeriesFormData() {
            const title = document.getElementById('seriesTitle').value;
            const year = parseInt(document.getElementById('seriesYear').value);
            const rating = parseFloat(document.getElementById('seriesRating').value);
            const poster = document.getElementById('seriesPoster').value;
            const backdrop = document.getElementById('seriesBackdrop').value;
            const language = document.getElementById('seriesLanguage').value;
            const category = document.getElementById('seriesCategory').value;
            const access = document.getElementById('seriesAccess').value;
            const storyline = document.getElementById('seriesStoryline').value;

            // Collect cast
            const cast = [];
            const castMembers = document.querySelectorAll('#seriesCastContainer .cast-member');
            castMembers.forEach(member => {
                const name = member.querySelector('.cast-name-input').value;
                const character = member.querySelector('.cast-character-input').value;
                const photo = member.querySelector('.cast-photo-input').value;
                
                if (name) {
                    cast.push({ name, character, photo });
                }
            });

            // Collect episodes
            const episodes = [];
            const episodeItems = document.querySelectorAll('#seriesEpisodesContainer .episode-item');
            episodeItems.forEach(item => {
                const season = parseInt(item.querySelector('.episode-season').value);
                const episodeNumber = parseInt(item.querySelector('.episode-number-input').value);
                const episodeName = item.querySelector('.episode-name').value;
                const link = item.querySelector('.episode-link').value;
                
                if (season && episodeNumber && link) {
                    episodes.push({ season, episode: episodeNumber, name: episodeName, link });
                }
            });

            if (!title || !year || !rating || !poster || !backdrop || !language || !category || !access || !storyline) {
                window.showNotification('Please fill in all required fields', 'error');
                return null;
            }

            return {
                id: Date.now().toString(),
                title,
                year,
                rating,
                poster,
                backdrop,
                language,
                category,
                access,
                storyline,
                cast,
                episodes,
                type: 'webseries'
            };
        }

        function collectMovieFormData() {
            const title = document.getElementById('movieTitle').value;
            const year = parseInt(document.getElementById('movieYear').value);
            const rating = parseFloat(document.getElementById('movieRating').value);
            const poster = document.getElementById('moviePoster').value;
            const backdrop = document.getElementById('movieBackdrop').value;
            const language = document.getElementById('movieLanguage').value;
            const category = document.getElementById('movieCategory').value;
            const access = document.getElementById('movieAccess').value;
            const storyline = document.getElementById('movieStoryline').value;
            const link = document.getElementById('movieLink').value;

            // Collect cast
            const cast = [];
            const castMembers = document.querySelectorAll('#movieCastContainer .cast-member');
            castMembers.forEach(member => {
                const name = member.querySelector('.cast-name-input').value;
                const character = member.querySelector('.cast-character-input').value;
                const photo = member.querySelector('.cast-photo-input').value;
                
                if (name) {
                    cast.push({ name, character, photo });
                }
            });

            if (!title || !year || !rating || !poster || !backdrop || !language || !category || !access || !storyline || !link) {
                window.showNotification('Please fill in all required fields', 'error');
                return null;
            }

            return {
                id: Date.now().toString(),
                title,
                year,
                rating,
                poster,
                backdrop,
                language,
                category,
                access,
                storyline,
                link,
                cast,
                type: 'movie'
            };
        }

        // Form utilities
        function clearForm(type) {
            if (type === 'series') {
                document.getElementById('webSeriesForm').reset();
                document.getElementById('seriesCastContainer').innerHTML = '';
                document.getElementById('seriesEpisodesContainer').innerHTML = '';
                document.getElementById('seriesTmdbId').value = '';
            } else if (type === 'movie') {
                document.getElementById('movieForm').reset();
                document.getElementById('movieCastContainer').innerHTML = '';
                document.getElementById('movieTmdbId').value = '';
            }

            castCounter = 0;
            episodeCounter = 0;
        }

        // Content loading functions
        function loadWebSeries() {
            renderWebSeriesGrid();
        }

        function loadMovies() {
            renderMoviesGrid();
        }

        function renderWebSeriesGrid() {
            const grid = document.getElementById('webSeriesGrid');
            const searchTerm = document.getElementById('seriesSearchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('seriesCategoryFilter').value;
            const accessFilter = document.getElementById('seriesAccessFilter').value;

            let filteredData = Object.entries(webSeriesData);

            // Apply filters
            if (searchTerm) {
                filteredData = filteredData.filter(([id, series]) => 
                    series.title.toLowerCase().includes(searchTerm)
                );
            }

            if (categoryFilter) {
                filteredData = filteredData.filter(([id, series]) => 
                    series.category === categoryFilter
                );
            }

            if (accessFilter) {
                filteredData = filteredData.filter(([id, series]) => 
                    series.access === accessFilter
                );
            }

            if (filteredData.length === 0) {
                grid.innerHTML = '<div class="loading">No web series found</div>';
                return;
            }

            const gridHtml = filteredData.map(([id, series]) => `
                <div class="content-card">
                    <div class="card-image" style="background-image: url('${series.poster}')">
                        <div class="card-overlay">
                            <span class="card-badge">${series.category}</span>
                            <span class="card-badge">${series.access}</span>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="card-title">${series.title}</div>
                        <div class="card-meta">
                            <span class="card-year">${series.year} ‚Ä¢ ${series.language}</span>
                            <span class="card-rating">‚≠ê ${series.rating}</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-small" onclick="editWebSeries('${id}')">Edit</button>
                            <button class="btn btn-small btn-secondary" onclick="viewWebSeries('${id}')">View</button>
                            <button class="btn btn-small btn-danger" onclick="deleteWebSeries('${id}')">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');

            grid.innerHTML = gridHtml;
        }

        function renderMoviesGrid() {
            const grid = document.getElementById('moviesGrid');
            const searchTerm = document.getElementById('movieSearchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('movieCategoryFilter').value;
            const accessFilter = document.getElementById('movieAccessFilter').value;

            let filteredData = Object.entries(moviesData);

            // Apply filters
            if (searchTerm) {
                filteredData = filteredData.filter(([id, movie]) => 
                    movie.title.toLowerCase().includes(searchTerm)
                );
            }

            if (categoryFilter) {
                filteredData = filteredData.filter(([id, movie]) => 
                    movie.category === categoryFilter
                );
            }

            if (accessFilter) {
                filteredData = filteredData.filter(([id, movie]) => 
                    movie.access === accessFilter
                );
            }

            if (filteredData.length === 0) {
                grid.innerHTML = '<div class="loading">No movies found</div>';
                return;
            }

            const gridHtml = filteredData.map(([id, movie]) => `
                <div class="content-card">
                    <div class="card-image" style="background-image: url('${movie.poster}')">
                        <div class="card-overlay">
                            <span class="card-badge">${movie.category}</span>
                            <span class="card-badge">${movie.access}</span>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="card-title">${movie.title}</div>
                        <div class="card-meta">
                            <span class="card-year">${movie.year} ‚Ä¢ ${movie.language}</span>
                            <span class="card-rating">‚≠ê ${movie.rating}</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-small" onclick="editMovie('${id}')">Edit</button>
                            <button class="btn btn-small btn-secondary" onclick="viewMovie('${id}')">View</button>
                            <button class="btn btn-small btn-danger" onclick="deleteMovie('${id}')">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');

            grid.innerHTML = gridHtml;
        }

        // Content actions
        function editWebSeries(id) {
            // Implementation for editing web series
            window.showNotification('Edit functionality coming soon!', 'info');
        }

        function viewWebSeries(id) {
            const series = webSeriesData[id];
            if (series) {
                alert(`Title: ${series.title}\nYear: ${series.year}\nRating: ${series.rating}\nCategory: ${series.category}\nAccess: ${series.access}\n\nStoryline: ${series.storyline}`);
            }
        }

        async function deleteWebSeries(id) {
            if (confirm('Are you sure you want to delete this web series?')) {
                try {
                    await window.FirebaseDB.deleteWebSeries(id);
                    window.showNotification('Web series deleted successfully!', 'success');
                } catch (error) {
                    window.showNotification('Error deleting web series: ' + error.message, 'error');
                }
            }
        }

        function editMovie(id) {
            // Implementation for editing movie
            window.showNotification('Edit functionality coming soon!', 'info');
        }

        function viewMovie(id) {
            const movie = moviesData[id];
            if (movie) {
                alert(`Title: ${movie.title}\nYear: ${movie.year}\nRating: ${movie.rating}\nCategory: ${movie.category}\nAccess: ${movie.access}\n\nStoryline: ${movie.storyline}`);
            }
        }

        async function deleteMovie(id) {
            if (confirm('Are you sure you want to delete this movie?')) {
                try {
                    await window.FirebaseDB.deleteMovie(id);
                    window.showNotification('Movie deleted successfully!', 'success');
                } catch (error) {
                    window.showNotification('Error deleting movie: ' + error.message, 'error');
                }
            }
        }

        // Search functions
        function searchWebSeries() {
            renderWebSeriesGrid();
        }

        function searchMovies() {
            renderMoviesGrid();
        }

        // Utility functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>